; =============================================================================
; PHP-FPM pool "www" – otimizado para Laravel local/produção
; =============================================================================

[www]

; Roda como www-data (mesmo UID/GID do Dockerfile)
user  = www-data
group = www-data

; Escuta em socket TCP (compatível com nginx e outros proxies)
listen = 0.0.0.0:9000

; ----- Gerenciamento de processos -------------------------------------------
; dynamic: sobe/desce workers conforme a demanda
pm                   = dynamic
pm.max_children      = 20          ; ajuste conforme RAM disponível (≈20 MB/worker)
pm.start_servers     = 4
pm.min_spare_servers = 2
pm.max_spare_servers = 6
pm.max_requests      = 500         ; recicla worker após 500 requests (evita leaks)

; ----- Logs de requests lentos -----------------------------------------------
slowlog              = /proc/self/fd/2
request_slowlog_timeout = 5s

; ----- Timeout de request ----------------------------------------------------
request_terminate_timeout = 60s

; ----- Status endpoint (usado por healthcheck / monitoramento) ---------------
pm.status_path       = /fpm-status
ping.path            = /fpm-ping
ping.response        = pong

; ----- Variáveis de ambiente que o FPM repassa para os workers ---------------
; Necessário para que $_ENV funcione no Laravel
clear_env            = no

; ----- Log de erros ----------------------------------------------------------
catch_workers_output = yes
decorate_workers_output = no          ; saída limpa para os logs do Docker
php_flag[display_errors] = off
