; =============================================================================
; php.ini customizado – Laravel 11 / PHP 8.2
; =============================================================================

; ----- Geral -----------------------------------------------------------------
expose_php          = Off       ; não expõe versão no header X-Powered-By
display_errors      = Off
log_errors          = On
error_log           = /proc/self/fd/2   ; redireciona para stderr (Docker logs)
error_reporting     = E_ALL & ~E_DEPRECATED & ~E_STRICT

; ----- Uploads / Memória -----------------------------------------------------
memory_limit        = 256M
upload_max_filesize = 50M
post_max_size       = 55M
max_execution_time  = 60
max_input_time      = 60

; ----- Fuso horário ----------------------------------------------------------
date.timezone       = America/Sao_Paulo

; ----- Sessions (usadas pelo Laravel mas sobrescritas pelo Redis) ------------
session.save_handler  = files
session.gc_maxlifetime = 7200

; ----- OPcache (ativo apenas em produção – ajuste conforme o stage) ----------
[opcache]
opcache.enable                 = 1
opcache.enable_cli             = 0
opcache.memory_consumption     = 128
opcache.interned_strings_buffer = 16
opcache.max_accelerated_files  = 10000
opcache.validate_timestamps    = ${OPCACHE_VALIDATE_TIMESTAMPS:-1}  ; 0 em prod
opcache.revalidate_freq        = 0
opcache.save_comments          = 1
opcache.fast_shutdown          = 1

; ----- Realpath cache (reduz chamadas stat()) --------------------------------
realpath_cache_size = 4096K
realpath_cache_ttl  = 600

; ----- Redis (php-redis) -----------------------------------------------------
[redis]
redis.session.locking_enabled = 1
redis.session.lock_expire     = 60
redis.session.lock_retries    = 100
redis.session.lock_wait_time  = 20000  ; microsegundos
